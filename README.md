# Thoughts on tags calculation by iceberg

Теги на айсберге

* Как лучше делать расчет, по запросы на тег или одним запросом сразу на все теги?
* Как лучше мерджить результаты, сохранять предварительные результаты, потом мерджить или вычислять новую таблицу, подменять ею основную и подмененную удалять? А если рассчитывали разными запросами, по запросу на тег?

* Отдельные треки расчета тегов по изменившимся данным, отдельные по всем данным но только по изменившимся тегам. В одном случае мы пересчитываем все теги, но сильно обрезаем количество пассажиров, в другом - пересчитываем всех пассажиров, но сильно обрезаем количество тегов

* Нужно ли для инита вместо пересчёта все пассажиры х все теги пересчитывать по тегам?

* В каком случае нужно делать проекции таблиц, чтобы снизить io, какой от этого выигрыш в лучшем/худшем случае?

* Теги храним в массиве или по строке на тег?

* Управление проекциями (добавление/удаление колонок)
* Расчет атомов, дневных, глобальных
* Переиспользование атомов разными условиями, опирающимися на одинаковые данные (есть внутренние поездки за 30 дней/есть внутренние поездки за 90 дней)

Мультитенантность: у каждого свои данные для тегирования / данные для тегирования общие на всю систему

* Нудно надёжное именование атомов. Возможно сущность, на которую они ссылаются, должга быть отдельной колонкой
* Нужен ли нам вообще дабл в атомах, почему мы не можем обойтись интом?
* Что если у нас не просто >, <=, < а ещё includes, starts with, etc
* Нужно трекать атомы, зависимые от времени и подумать, как понять что их нужно обновить
